angular.module("ubnt-ui",["ubnt-app-tpls"]);angular.module("ubnt-ctrls",[]);angular.module("ubnt-srvcs",[]);angular.module("ubnt-drctvs",[]);angular.module("ubnt-srvcs").value("strip-first-line",function(str){var arr=str.split(/\n/);arr.shift();return arr.join("\n")});document.addEventListener("deviceready",function(){angular.bootstrap(document.body,["ubnt-app"])});angular.module("ubnt-app",["ubnt-ui","ubnt-srvcs","ubnt-ctrls","ubnt-drctvs"]);angular.module("ubnt-srvcs").factory("ssh-connection",[function(){"use strict";var connection_requests=new Rx.Subject;var _session_server=function(connectionSubj,ssh_connection){var _close_connection=function(err){ssh_connection.disconnect();if(err)connectionSubj.onError(err);else connectionSubj.onComplete()};connectionSubj.onNext({getSession:function(){var stdout=new Rx.Subject;var stdin=new Rx.Subject;var stdin_queue=stdin.pausableBuffered();stdin_queue.subscribe(function(cmd){stdin_queue.pause();ssh_connection.exec(cmd,function(resp){stdout.onNext(resp);stdin_queue.resume()},_close_connection)});stdin_queue.resume();return{stdin:stdin.asObserver(),stdout:stdout.asObservable(),close:_close_connection}}})};return{connect:function(conn_params){var connectionSubj=new Rx.ReplaySubject(1);alec_ssh.connect(conn_params.host,conn_params.user,conn_params.pass,_session_server.bind(null,connectionSubj),connectionSubj.onError);var connection_observable=connectionSubj.asObservable();connection_requests.onNext(connection_observable);return connection_observable},connectionRequests:connection_requests.asObservable()}}]);angular.module("ubnt-srvcs").factory("ubnt-connection",["ssh-connection",function(ssh){"use strict";var _connections=new Rx.ReplaySubject(1);var connection=_connections.switch();connection.login=function(conn_params){var _conn=ssh.connect(conn_params);_connections.onNext(_conn);return _conn};connection.reqs=_connections;return connection}]);(function(){"use strict";var _strip_first_line=function(str){var arr=str.split(/\n/);arr.shift();return arr.join("\n")}})();angular.module("ubnt-srvcs").factory("ubnt-survey",["ubnt-connection","strip-first-line",function(connection,_strip_first_line){"use strict";var session=connection.map(function(ssh_conn){return ssh_conn.getSession()});var executer=session.map(function(ssh_sess){ssh_sess.stdin("/usr/www/survey.json.cgi");return ssh_sess.stdout.take(1).map(function(resp_str){var resp_str_strip=_strip_first_line(resp_str);var links=JSON.parse(resp_str_strip);links.sort(function(a,b){return a.signal_level>b.signal_level});return links})});var surveys=Rx.Observable.create(function(observer){var to;var execute=function(){executer.take(1).do(function(){to=setTimeout(execute,surveys.interval)}).subscribe(observer)};return function(){clearTimeout(to)}});surveys.interval=500;return surveys}]);angular.module("ubnt-app-tpls",[]).run(["$templateCache",function($templateCache){"use strict";$templateCache.put("/tpls/connect.html",'<div class="row">\n'+'  <div class="form-group col-xs-12">\n'+"    <label>Host</label>\n"+'    <input class="form-control" ng-model="conn_params.host">\n'+"  </div>\n"+'  <div class="form-group col-xs-12">\n'+"    <label>User</label>\n"+'    <input class="form-control" ng-model="conn_params.user">\n'+"  </div>\n"+'  <div class="form-group col-xs-12">\n'+"    <label>Password</label>\n"+'    <input class="form-control" ng-model="conn_params.pass">\n'+"  </div>\n"+'  <button ng-hide="isConnected" ng-disabled="!conn_params.host || _connecting" class="btn btn-primary col-xs-5 col-xs-offset-7" ng-click="connect()">Connect</button>\n'+'  <button ng-show="isConnected" class="btn btn-warning col-xs-5 col-xs-offset-7" ng-click="disconnect()">Disconnect</button>\n'+"</div>");$templateCache.put("/tpls/link.html",'<div class="row">\n'+"\n"+"</div>");$templateCache.put("/tpls/main.html","<div>\n"+'  <div class="btn-group" id="menu" role="group" aria-label="menu" style="width:100%">\n'+'    <button type="button" ng-click="setPage(\'connect\')" aria-label="connect" class="btn btn-default" style="width:25%"><i class="glyphicon glyphicon-flash"></i>\n'+"    </button>\n"+'    <button type="button" ng-click="setPage(\'scan\')" aria-label="scan" class="btn btn-default" ng-disabled="!isConnected" style="width:25%"><i class="glyphicon glyphicon-list"></i>\n'+"    </button>\n"+'    <button type="button" ng-click="setPage(\'status\')" aria-label="status" class="btn btn-default" ng-disabled="!isConnected" style="width:25%"><i class="glyphicon glyphicon-list-alt"></i>\n'+"    </button>\n"+'    <button type="button" ng-click="setPage(\'link\')" aria-label="link" class="btn btn-default" ng-disabled="!isConnected" style="width:25%"><i class="glyphicon glyphicon-link"></i>\n'+"    </button>\n"+"  </div>\n"+'  <div class="container-fluid" id="container">\n'+"    <ubnt-connect ng-show=\"!page || page === 'connect'\"></ubnt-connect>\n"+"    <ubnt-survey ng-show=\"page==='scan'\"></ubnt-survey>\n"+"    <ubnt-status ng-show=\"page==='status'\"></ubnt-status>\n"+"    <ubnt-link ng-show=\"page==='link'\"></ubnt-link>\n"+"  </div>\n"+"</div>");$templateCache.put("/tpls/status.html",'<div class="row">\n'+"\n"+"</div>");$templateCache.put("/tpls/survey.html",'<div class="row">\n'+'  <audio class="beep" autobuffer>\n'+'    <source src="assets/beep.ogg" type="audio/ogg">\n'+"  </audio>\n"+'  <span class="col-xs-12 label label-primary">\n'+'    <span class="col-xs-12">{{links[0].essid}}</span>\n'+'    <span class="col-xs-12">~ {{links[0].signal_level}}/{{links[0].noise_level}} dB</span>\n'+"  </span>\n"+'  <span class="clearfix"></span>\n'+'  <span class="col-xs-12 label label-default" ng-repeat="link in links.slice(1)">\n'+'    <span class="col-xs-12">{{link.essid}}</span>\n'+'    <span class="col-xs-12">~ {{link.signal_level}}/{{link.noise_level}} dB</span>\n'+"  </span>\n"+"\n"+"</div>")}]);(function(){angular.module("ubnt-ui").directive("ubntConnect",["ubnt-connection",function(connection){var _scope_link={connect:function(){var scope=this;connection.login(this.conn_params).subscribe(this.pendingReqs)},disconnect:function(){
//scope.isConnected = true;
return connection.take(1).do(function(conn_ssh){conn_ssh.disconnect()}).subscribe(this.pendingReqs)},conn_params:{host:"192.168.1.20",user:"root",pass:"k0me1n1"}};return{restrict:"E",templateUrl:"/tpls/connect.html",link:function(sc){angular.extend(sc,_scope_link);sc.pendingReqs=Rx.Observer.create({onNext:function(){scope.isConnected=true},onError:function(){scope.isConnected=false},onCompleted:function(){scope.isConnected=false}})}}}])})();(function(){angular.module("ubnt-ui").directive("ubntLink",function(){return{restrict:"E",templateUrl:"/tpls/link.html"}})})();(function(){angular.module("ubnt-ui").directive("ubntMain",["ubnt-connection",function(connection){var _scope_link={
// isConnected: function() {
//   return connection.isActive();
// },
setPage:function(page){this.page=page}};return{restrict:"E",templateUrl:"/tpls/main.html",link:function(sc){angular.extend(sc,_scope_link);var set_connected=function(){sc.isConnected=true};var set_disconnected=function(){sc.isConnected=false};connection.reqs.subscribe(function(req_obs){req_obs.do(sc.$applyAsync.bind(sc)).subscribe(set_connected,set_disconnected,set_disconnected)});set_disconnected()}}}])})();(function(){angular.module("ubnt-ui").directive("ubntStatus",function(){return{restrict:"E",templateUrl:"/tpls/status.html"}})})();(function(){angular.module("ubnt-ui").directive("ubntSurvey",["ubnt-survey",function(survey){
// var _scope_link = {};
return{restrict:"E",templateUrl:"/tpls/survey.html",link:function(scope){
// var _beep_elem = elem[0].querySelector('.beep');
// _beep_elem.volume = .02;
// _beep_elem.play();
// angular.extend(scope, _scope_link);
survey.subscribe(function(links){scope.links=links||[]})}}}])})();
//# sourceMappingURL=app.js.map